<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Skynox</title>

<meta name="theme-color" content="#667eea">
<link rel="manifest" href="manifest.json">

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
</script>

<style>
*{box-sizing:border-box;font-family:system-ui,sans-serif;margin:0;padding:0}
body{min-height:100vh;display:flex;justify-content:center;padding:12px;
background:linear-gradient(135deg,#667eea,#764ba2)}
.app{width:100%;max-width:390px;min-height:100vh;padding:16px;
border-radius:22px;background:rgba(255,255,255,.18);
backdrop-filter:blur(16px);color:#000}

input,button{width:100%;padding:12px;border-radius:12px;border:none;margin-bottom:10px}
button{font-weight:bold;background:rgba(255,255,255,.35)}
#installBtn{display:none;background:#000;color:#fff}

.card{background:rgba(255,255,255,.25);padding:12px;border-radius:16px;margin-bottom:12px}
canvas{width:100%;height:120px;border-radius:12px}

.aqi{padding:6px 10px;border-radius:999px;font-weight:bold;display:inline-block}
.good{background:#2ecc71;color:#fff}
.moderate{background:#f1c40f;color:#000}
.poor{background:#e67e22;color:#fff}
.severe{background:#e53935;color:#fff}

.expand{max-height:0;overflow:hidden;transition:max-height .3s ease}
.expand.open{max-height:700px}

.hour-row{display:flex;justify-content:space-between;font-size:12px;
padding:4px 0;border-bottom:1px solid rgba(255,255,255,.2)}
.marker{font-weight:bold;font-size:11px}
.min{color:#42a5f5}
.max{color:#e53935}

@media(prefers-color-scheme:dark){
body{background:linear-gradient(135deg,#0f2027,#203a43,#2c5364)}
.app{background:rgba(0,0,0,.35);color:#fff}
}
</style>
</head>

<body>
<div class="app">

<h1>ğŸŒ¦ Skynox</h1>

<input id="cityInput" placeholder="Search city">
<button id="searchBtn">Search</button>
<button id="locBtn">ğŸ“ Use My Location</button>
<button id="installBtn">â¬‡ Install Skynox</button>

<h2 id="location">--</h2>
<p id="temp">--Â°</p>

<!-- NEXT 24H -->
<div class="card" id="hourlyCard">
<h4>Next 24h Temperature</h4>
<small id="hourlyMinMax">--</small>
<canvas id="hourlyChart"></canvas>
<div id="hourlyExpand" class="expand"></div>
</div>

<!-- AQI -->
<div class="card">
<h4>ğŸŒ« Air Quality (PM2.5)</h4>
<div id="aqiBadge" class="aqi">--</div>
<p id="aqiTrend">--</p>
<p id="aqiText" style="font-size:13px;margin-top:4px">--</p>
<canvas id="aqiChart"></canvas>
</div>

<h3>ğŸ“… 7-Day Forecast</h3>
<div id="forecast"></div>

</div>

<script>
const $=e=>document.getElementById(e);

/* ---------- AQI INFO ---------- */
function aqiInfo(pm){
if(pm<=30)return["Good","good","Air quality is good"];
if(pm<=60)return["Moderate","moderate","Sensitive people be cautious"];
if(pm<=90)return["Poor","poor","Avoid long outdoor activity"];
return["Severe","severe","Stay indoors, wear mask"];
}

/* ---------- BAR CHART ---------- */
function barChart(id,data){
const c=$(id),ctx=c.getContext("2d");
c.width=c.offsetWidth;c.height=120;
ctx.clearRect(0,0,c.width,c.height);
const min=Math.min(...data),max=Math.max(...data);
const r=max-min||1;
data.forEach((v,i)=>{
const h=((v-min)/r)*c.height;
ctx.fillStyle="#42a5f5";
ctx.fillRect(i*(c.width/data.length),
c.height-h,c.width/data.length-2,h);
});
}

/* ---------- WEATHER ---------- */
async function loadWeather(lat,lon,name){
let w,a;
try{
w=await fetch(
`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,relativehumidity_2m,windspeed_10m&daily=temperature_2m_min,temperature_2m_max&timezone=auto`
).then(r=>r.json());

a=await fetch(
`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5`
).then(r=>r.json());

localStorage.setItem("skynox_aqi_cache",JSON.stringify(a));
}catch{
a=JSON.parse(localStorage.getItem("skynox_aqi_cache"));
if(!a) return;
}

$("location").textContent=name;
$("temp").textContent=Math.round(w.current_weather.temperature)+"Â°C";

/* ---- 24H TEMP ---- */
const t24=w.hourly.temperature_2m.slice(0,24);
const minT=Math.min(...t24), maxT=Math.max(...t24);
$("hourlyMinMax").textContent=`Min ${minT}Â° / Max ${maxT}Â°`;
barChart("hourlyChart",t24);

/* ---- Hourly Expand ---- */
const exp=$("hourlyExpand");
exp.innerHTML="";
for(let i=0;i<24;i++){
let tag="";
if(t24[i]===minT) tag=`<span class="marker min">â— MIN</span>`;
if(t24[i]===maxT) tag=`<span class="marker max">â— MAX</span>`;
exp.innerHTML+=`
<div class="hour-row">
<span>${i}:00</span>
<span>${t24[i]}Â° ${tag}</span>
<span>${w.hourly.relativehumidity_2m[i]}%</span>
<span>${w.hourly.windspeed_10m[i]} km/h</span>
</div>`;
}

/* ---- AQI ---- */
const pm=a.hourly.pm2_5[0];
const prev=a.hourly.pm2_5[1] ?? pm;
const [label,cls,text]=aqiInfo(pm);

$("aqiBadge").className="aqi "+cls;
$("aqiBadge").textContent=pm+" Â· "+label;
$("aqiText").textContent=text;

$("aqiTrend").textContent=
pm>prev?"â†‘ Worsening":
pm<prev?"â†“ Improving":"â†’ Stable";

barChart("aqiChart",a.hourly.pm2_5.slice(0,24));

/* ---- Forecast ---- */
const f=$("forecast");f.innerHTML="";
w.daily.temperature_2m_max.forEach((_,i)=>{
f.innerHTML+=`
<div class="card">
Day ${i+1}: ${w.daily.temperature_2m_max[i]}Â° /
${w.daily.temperature_2m_min[i]}Â°
</div>`;
});
}

/* ---------- TOGGLE EXPAND ---------- */
$("hourlyCard").onclick=()=>{
$("hourlyExpand").classList.toggle("open");
};

/* ---------- SEARCH ---------- */
$("searchBtn").onclick=async()=>{
const q=$("cityInput").value.trim();
if(!q)return;
const r=await fetch(
`https://geocoding-api.open-meteo.com/v1/search?name=${q}&count=1`
).then(r=>r.json());
if(r.results)
loadWeather(
r.results[0].latitude,
r.results[0].longitude,
r.results[0].name
);
};

/* ---------- LOCATION ---------- */
$("locBtn").onclick=()=>{
navigator.geolocation.getCurrentPosition(p=>
loadWeather(p.coords.latitude,p.coords.longitude,"Current Location"));
};

/* ---------- BOOT ---------- */
loadWeather(28.61,77.23,"Delhi, India");
</script>

</body>
</html>
