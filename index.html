<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Skynox</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#667eea">

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui}
body{
  min-height:100svh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:linear-gradient(135deg,#667eea,#764ba2);
  padding:14px;
}
body.dark{background:#000}
.app{
  width:100%;
  max-width:390px;
  min-height:100svh;
  background:rgba(255,255,255,.18);
  backdrop-filter:blur(18px);
  border:1px solid rgba(255,255,255,.35);
  border-radius:26px;
  padding:18px;
  display:flex;
  flex-direction:column;
  gap:14px;
}
body.dark .app{background:rgba(0,0,0,.45);color:#fff}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.toggle{
  width:36px;height:36px;
  border-radius:50%;
  border:1px solid rgba(255,255,255,.4);
  background:rgba(255,255,255,.25);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
input,button{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:none;
}
button{font-weight:600}
.card{
  background:rgba(255,255,255,.25);
  border-radius:18px;
  padding:14px;
}
.stat-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  font-size:14px;
}
footer{
  text-align:center;
  font-size:12px;
  opacity:.8;
  margin-top:auto;
}

/* AQI */
.aqi{
  padding:6px 12px;
  border-radius:999px;
  font-weight:700;
  display:inline-block;
  margin-bottom:6px;
}
.aqi.good{background:#2ecc71;color:#fff}
.aqi.moderate{background:#f1c40f;color:#000}
.aqi.poor{background:#e67e22;color:#fff}
.aqi.severe{background:#e53935;color:#fff}

.aqi-bar{
  height:8px;
  background:rgba(255,255,255,.25);
  border-radius:8px;
  overflow:hidden;
  margin:6px 0;
}
#aqiFill{
  display:block;
  height:100%;
  width:0%;
}
canvas{width:100%;border-radius:12px}
</style>
</head>

<body>
<div class="app">

<header>
  <h2>üå¶ Skynox</h2>
  <div class="toggle" id="darkToggle">üåô</div>
</header>

<input id="cityInput" placeholder="Search city">
<button id="searchBtn">Search</button>
<button id="locBtn">üìç Use Current Location</button>
<button id="installBtn" style="display:none">‚¨á Install App</button>

<h3 id="location">--</h3>
<h1 id="temp">--¬∞C</h1>

<div class="card">
  <div class="stat-grid">
    <div>Feels like<br><b id="feelsLike">--</b></div>
    <div>Humidity<br><b id="humidity">--</b></div>
    <div>Wind<br><b id="wind">--</b></div>
    <div>Pressure<br><b id="pressure">--</b></div>
  </div>
</div>

<div class="card">
  <h3>üå´ Air Quality</h3>
  <div id="aqiBadge" class="aqi">--</div>
  <p id="aqiPM">PM2.5: --</p>
  <p id="aqiTrend">--</p>
  <div class="aqi-bar"><span id="aqiFill"></span></div>
  <p id="aqiText"></p>
  <p id="maskTip"></p>
  <canvas id="aqiChart" height="110"></canvas>
</div>

<footer>¬© Manik Roy 2025. All Rights Reserved.</footer>
</div>

<script>
const $=id=>document.getElementById(id);

/* DARK MODE */
if(localStorage.theme==="dark")document.body.classList.add("dark");
$("darkToggle").onclick=()=>{
  document.body.classList.toggle("dark");
  localStorage.theme=document.body.classList.contains("dark")?"dark":"light";
};

/* SERVICE WORKER */
if("serviceWorker"in navigator){
  navigator.serviceWorker.register("sw.js");
}

/* INSTALL */
let dp;
window.addEventListener("beforeinstallprompt",e=>{
  e.preventDefault();dp=e;$("installBtn").style.display="block";
});
$("installBtn").onclick=()=>dp?.prompt();

/* AQI HELPERS */
function pm25ToAQI(pm){
  const bp=[[0,12,0,50],[12.1,35.4,51,100],[35.5,55.4,101,150],[55.5,150.4,151,200],[150.5,250.4,201,300],[250.5,500,301,500]];
  for(const[bL,bH,aL,aH]of bp)
    if(pm>=bL&&pm<=bH)
      return Math.round(((aH-aL)/(bH-bL))*(pm-bL)+aL);
  return 500;
}
function aqiInfo(a){
  if(a<=50)return["Good","good","#2ecc71","Air quality is good","üòå No mask"];
  if(a<=100)return["Moderate","moderate","#f1c40f","Sensitive groups be cautious","üòê Sensitive mask"];
  if(a<=150)return["Unhealthy (Sensitive)","poor","#e67e22","Reduce outdoor activity","üò∑ Mask recommended"];
  return["Unhealthy","severe","#e53935","Avoid outdoor exposure","üò∑ N95 advised"];
}
function drawAQI(arr,color){
  const c=$("aqiChart"),ctx=c.getContext("2d");
  c.width=c.offsetWidth;c.height=110;
  ctx.clearRect(0,0,c.width,c.height);
  const min=Math.min(...arr),max=Math.max(...arr),r=max-min||1;
  arr.forEach((v,i)=>{
    const h=((v-min)/r)*c.height;
    ctx.fillStyle=color;
    ctx.fillRect(i*(c.width/arr.length),c.height-h,(c.width/arr.length)-2,h);
  });
}

/* WEATHER + AQI */
async function loadWeather(lat,lon,name){
  const w=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,relativehumidity_2m,windspeed_10m,pressure_msl&timezone=auto`).then(r=>r.json());
  const aq=await fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5&timezone=auto`).then(r=>r.json());

  let idx=w.hourly.time.indexOf(w.current_weather.time);
  if(idx===-1) idx=0;

  $("location").textContent=name;
  $("temp").textContent=Math.round(w.current_weather.temperature)+"¬∞C";

  const h=w.hourly.relativehumidity_2m[idx];
  const wi=w.hourly.windspeed_10m[idx];
  const p=w.hourly.pressure_msl[idx];
  const t=w.current_weather.temperature;

  $("humidity").textContent=h+"%";
  $("wind").textContent=wi+" km/h";
  $("pressure").textContent=p+" hPa";
  $("feelsLike").textContent=Math.round(t-(wi*0.7)+(h*0.01))+"¬∞C";

  const pm=aq.hourly.pm2_5[idx] ?? aq.hourly.pm2_5[0];
  const pmPrev=aq.hourly.pm2_5[idx+1] ?? pm;
  const aqi=pm25ToAQI(pm);
  const aqiPrev=pm25ToAQI(pmPrev);
  const [lab,cls,col,txt,mask]=aqiInfo(aqi);

  $("aqiBadge").className="aqi "+cls;
  $("aqiBadge").textContent=`AQI ${aqi} ¬∑ ${lab}`;
  $("aqiPM").textContent=`PM2.5: ${pm} ¬µg/m¬≥`;
  $("aqiText").textContent=txt;
  $("maskTip").textContent=mask;
  $("aqiTrend").textContent=aqi>aqiPrev?"‚Üë Worsening":aqi<aqiPrev?"‚Üì Improving":"‚Üí Stable";
  $("aqiFill").style.width=Math.min(aqi/5,100)+"%";
  $("aqiFill").style.background=col;

  drawAQI(aq.hourly.pm2_5.slice(idx,idx+24).map(pm25ToAQI),col);
}

$("searchBtn").onclick=async()=>{
  const q=$("cityInput").value.trim();
  if(!q)return;
  const g=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${q}&count=1`).then(r=>r.json());
  if(g.results)loadWeather(g.results[0].latitude,g.results[0].longitude,g.results[0].name);
};
$("locBtn").onclick=()=>navigator.geolocation.getCurrentPosition(p=>{
  loadWeather(p.coords.latitude,p.coords.longitude,"Current Location");
});

loadWeather(28.61,77.23,"Delhi, India");
</script>
</body>
</html>
