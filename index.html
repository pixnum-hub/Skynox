<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Skynox</title>

<meta name="theme-color" content="#667eea">
<link rel="manifest" href="manifest.json">

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
</script>

<style>
*{box-sizing:border-box;font-family:system-ui,sans-serif;margin:0;padding:0}
body{min-height:100vh;display:flex;justify-content:center;padding:12px;
background:linear-gradient(135deg,#667eea,#764ba2)}
.app{width:100%;max-width:390px;min-height:100vh;padding:16px;
border-radius:22px;background:rgba(255,255,255,.18);
backdrop-filter:blur(16px);color:#000;position:relative}

input,button{width:100%;padding:12px;border-radius:12px;
border:none;margin-bottom:10px;font-size:14px}
button{font-weight:bold;background:rgba(255,255,255,.35)}

.icon{text-align:center;font-size:48px}
.big{font-size:22px;font-weight:bold}

.card{margin-bottom:12px;padding:12px;border-radius:16px;
background:rgba(255,255,255,.25)}

.details,.lifestyle{display:grid;grid-template-columns:1fr 1fr;gap:12px}

#installBtn{background:#000;color:#fff;display:none}

canvas{width:100%;height:120px;border-radius:12px}

.day-card{padding:12px;border-radius:16px;
background:rgba(255,255,255,.25);margin-bottom:10px}

.day-header{display:flex;justify-content:space-between;font-weight:bold}

.temp-range{font-size:13px;opacity:.9;margin-top:4px}

@media(prefers-color-scheme:dark){
body{background:linear-gradient(135deg,#0f2027,#203a43,#2c5364)}
.app{background:rgba(0,0,0,.35);color:#fff}
}
</style>
</head>

<body>
<div class="app">

<h1>ğŸŒ¦ Skynox</h1>

<input id="cityInput" placeholder="Search city">
<button id="searchBtn">Search</button>
<button id="locBtn">ğŸ“ Use My Location</button>

<button id="installBtn">â¬‡ Install Skynox</button>

<h2 id="location">--</h2>
<div class="icon" id="icon">â›…</div>

<p id="temp">--Â°</p>
<p id="feels">Feels like --</p>

<div class="card">
<h4>Next 24h Temperature</h4>
<small id="hourlyMinMax">Min --Â° / Max --Â°</small>
<canvas id="hourlyChart"></canvas>
</div>

<div class="card">
<h4>ğŸŒ« Air Quality (PM2.5)</h4>
<div id="aqiBadge">--</div>
<canvas id="aqiChart"></canvas>
</div>

<h3>ğŸ“… 7-Day Forecast</h3>
<div id="forecast"></div>

<footer style="margin-top:20px;font-size:11px;text-align:center">
Â© Manik Roy 2025 Â· Skynox
</footer>

</div>

<script>
const $=e=>document.getElementById(e);
const icons={0:"â˜€",1:"ğŸŒ¤",2:"â›…",3:"â˜",61:"ğŸŒ§",71:"â„",95:"â›ˆ"};

/* ---------- CHARTS ---------- */
function barChart(id,data){
const c=$(id),ctx=c.getContext("2d");
c.width=c.offsetWidth;c.height=120;
ctx.clearRect(0,0,c.width,c.height);
const min=Math.min(...data),max=Math.max(...data);
data.forEach((v,i)=>{
const h=((v-min)/(max-min))*c.height;
ctx.fillStyle="#42a5f5";
ctx.fillRect(i*(c.width/24),c.height-h,c.width/24-2,h);
});
}

/* ---------- WEATHER ---------- */
async function loadWeather(lat,lon,name){
const w=await fetch(
`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}
&current_weather=true
&hourly=temperature_2m
&daily=temperature_2m_min,temperature_2m_max,weathercode
&timezone=auto`
).then(r=>r.json());

const a=await fetch(
`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5`
).then(r=>r.json());

$("location").textContent=name;
$("temp").textContent=Math.round(w.current_weather.temperature)+"Â°C";
$("feels").textContent="Feels like "+Math.round(w.current_weather.temperature)+"Â°C";
$("icon").textContent=icons[w.current_weather.weathercode]||"â›…";

/* 24h min / max */
const t24=w.hourly.temperature_2m.slice(0,24);
$("hourlyMinMax").textContent=
"Min "+Math.min(...t24)+"Â° / Max "+Math.max(...t24)+"Â°";

barChart("hourlyChart",t24);

/* AQI */
$("aqiBadge").textContent=a.hourly.pm2_5[0];
barChart("aqiChart",a.hourly.pm2_5.slice(0,24));

/* Forecast */
const f=$("forecast");f.innerHTML="";
w.daily.time.forEach((d,i)=>{
f.innerHTML+=`
<div class="day-card">
<div class="day-header">${d.slice(5)}</div>
<div class="temp-range">
Max ${w.daily.temperature_2m_max[i]}Â° /
Min ${w.daily.temperature_2m_min[i]}Â°
</div>
</div>`;
});
}

/* ---------- SEARCH ---------- */
$("searchBtn").onclick=async()=>{
const q=$("cityInput").value.trim();
if(!q)return;
const r=await fetch(
`https://geocoding-api.open-meteo.com/v1/search?name=${q}&count=1`
).then(r=>r.json());
if(r.results)loadWeather(
r.results[0].latitude,
r.results[0].longitude,
r.results[0].name
);
};

$("locBtn").onclick=()=>{
navigator.geolocation.getCurrentPosition(p=>
loadWeather(p.coords.latitude,p.coords.longitude,"Current Location"));
};

/* ---------- PWA INSTALL + ANALYTICS ---------- */
let deferredPrompt;
const installBtn=$("installBtn");

const stats=JSON.parse(localStorage.getItem("skynox_install_stats"))||{
prompted:0,accepted:0,dismissed:0,installed:0};

const save=()=>localStorage.setItem(
"skynox_install_stats",JSON.stringify(stats));

window.addEventListener("beforeinstallprompt",e=>{
e.preventDefault();deferredPrompt=e;
stats.prompted++;save();
installBtn.style.display="block";
});

installBtn.onclick=async()=>{
deferredPrompt.prompt();
const r=await deferredPrompt.userChoice;
r.outcome==="accepted"?stats.accepted++:stats.dismissed++;
save();installBtn.style.display="none";
};

window.addEventListener("appinstalled",()=>{
stats.installed++;save();
installBtn.style.display="none";
});

/* ---------- BOOT ---------- */
loadWeather(28.61,77.23,"Delhi, India");
</script>

</body>
</html>
