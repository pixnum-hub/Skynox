<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Skynox</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#667eea">

<style>
*{box-sizing:border-box;font-family:system-ui;margin:0;padding:0}
body{
  min-height:100svh;
  display:flex;
  justify-content:center;
  padding:12px;
  background:linear-gradient(135deg,#667eea,#764ba2);
}
body.dark{
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
}
.app{
  width:100%;
  max-width:390px;
  padding:16px;
  border-radius:22px;
  background:rgba(255,255,255,.18);
  backdrop-filter:blur(16px);
  display:flex;
  flex-direction:column;
  gap:16px;
}
body.dark .app{background:rgba(0,0,0,.35)}

button,input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:none;
}
button{font-weight:700}

.card{
  background:rgba(255,255,255,.25);
  padding:14px;
  border-radius:16px;
  display:flex;
  flex-direction:column;
  gap:8px;
}
body.dark .card{background:rgba(0,0,0,.35)}

.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.toggle{
  width:36px;height:36px;
  border-radius:50%;
  border:1px solid rgba(255,255,255,.4);
  background:transparent;
  font-size:18px;
}

.aqi{
  padding:6px 12px;
  border-radius:999px;
  font-weight:700;
  display:inline-block;
}
.aqi.good{background:#2ecc71;color:#fff}
.aqi.moderate{background:#f1c40f;color:#000}
.aqi.poor{background:#e67e22;color:#fff}
.aqi.severe{background:#e53935;color:#fff}

.aqi-bar{
  height:8px;
  background:rgba(255,255,255,.3);
  border-radius:8px;
  overflow:hidden;
}
#aqiFill{height:100%;display:block;width:0%}

.hourly-icons{
  display:flex;
  overflow-x:auto;
  gap:12px;
}
.hour{
  min-width:56px;
  text-align:center;
  font-size:12px;
}

.forecast-list{
  display:flex;
  flex-direction:column;
  gap:10px;
}
.day-row{
  display:flex;
  justify-content:space-between;
  padding:10px;
  border-radius:12px;
  background:rgba(255,255,255,.25);
}
body.dark .day-row{background:rgba(0,0,0,.35)}

footer{
  text-align:center;
  font-size:12px;
  opacity:.7;
}
canvas{width:100%}
</style>
</head>

<body>
<div class="app">

<div class="topbar">
  <h2>ğŸŒ¦ Skynox</h2>
  <button class="toggle" id="themeBtn">ğŸŒ™</button>
</div>

<div class="card" id="offlineCard" style="display:none">
  <b>ğŸ“¡ Offline mode</b>
  <small>Showing last known location</small>
</div>

<input id="cityInput" placeholder="Search city">
<button id="searchBtn">Search</button>
<button id="locBtn">ğŸ“ Use My Location</button>

<div class="card">
  <h3 id="location">--</h3>
  <h1 id="temp">--Â°C</h1>
</div>

<div class="card">
  <h3>ğŸ“ Current Conditions</h3>
  <p>ğŸ•’ <span id="localTime">--</span></p>
  <p>ğŸ¤’ Feels like: <b id="feelsLike">--Â°C</b></p>
  <p>ğŸ’§ Humidity: <b id="humidity">--%</b></p>
  <p>ğŸ’¨ Wind: <b id="wind">-- km/h</b>
     <span id="windCompass" style="display:inline-block">â¬†ï¸</span>
  </p>
  <p>ğŸ“ˆ Pressure: <b id="pressure">-- hPa</b></p>
  <p>ğŸŒ… Sunrise: <b id="sunrise">--</b></p>
  <p>ğŸŒ‡ Sunset: <b id="sunset">--</b></p>
</div>

<div class="card">
  <h3>â± Next 24 Hours</h3>
  <p>ğŸŒ¡ Min: <b id="min24">--Â°C</b> | ğŸŒ¡ Max: <b id="max24">--Â°C</b></p>
</div>

<div class="card">
  <h3>ğŸ•’ Hourly Conditions</h3>
  <div id="hourlyIcons" class="hourly-icons"></div>
</div>

<div class="card">
  <h3>ğŸ“… 7-Day Forecast</h3>
  <div id="dailyForecast" class="forecast-list"></div>
</div>

<div class="card">
  <h3>ğŸŒ« Air Quality</h3>
  <div id="aqiBadge" class="aqi">--</div>
  <p id="aqiPM">--</p>
  <p id="aqiTrend">--</p>
  <div class="aqi-bar"><span id="aqiFill"></span></div>
  <canvas id="aqiChart" height="120"></canvas>
  <p id="aqiText"></p>
  <p id="maskTip"></p>
</div>

<footer>Â© Manik Roy 2025. All Rights Reserved.</footer>

</div>

<script>
const $=id=>document.getElementById(id);

/* ---------- Theme ---------- */
themeBtn.onclick=()=>{
  document.body.classList.toggle("dark");
  localStorage.theme=document.body.classList.contains("dark");
};
if(localStorage.theme==="true")document.body.classList.add("dark");

/* ---------- AQI helpers ---------- */
function pm25ToAQI(pm){
  const bp=[[0,12,0,50],[12.1,35.4,51,100],[35.5,55.4,101,150],[55.5,150.4,151,200],[150.5,250.4,201,300],[250.5,500,301,500]];
  for(const[bL,bH,aL,aH] of bp)
    if(pm>=bL&&pm<=bH)
      return Math.round(((aH-aL)/(bH-bL))*(pm-bL)+aL);
  return 500;
}
function aqiInfo(a){
  if(a<=50)return["Good","good","#2ecc71","Air quality is good","ğŸ˜Œ No mask"];
  if(a<=100)return["Moderate","moderate","#f1c40f","Sensitive people cautious","ğŸ˜ Mask if sensitive"];
  if(a<=150)return["Unhealthy","poor","#e67e22","Reduce outdoor activity","ğŸ˜· Mask advised"];
  return["Severe","severe","#e53935","Avoid outdoors","ğŸ˜· N95 required"];
}

/* ---------- AQI chart ---------- */
function drawAQI(data){
  const c=aqiChart.getContext("2d");
  aqiChart.width=aqiChart.offsetWidth;
  c.clearRect(0,0,aqiChart.width,aqiChart.height);
  const max=Math.max(...data);
  data.forEach((v,i)=>{
    const h=(v/max)*aqiChart.height;
    c.fillStyle="#e53935";
    c.fillRect(i*(aqiChart.width/data.length),
      aqiChart.height-h,
      aqiChart.width/data.length-2,h);
  });
}

/* ---------- Weather Loader ---------- */
let watchId=null;

async function loadWeather(lat,lon,name){
try{
const w=await fetch(
`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}
&current_weather=true
&hourly=temperature_2m,apparent_temperature,relativehumidity_2m,windspeed_10m,winddirection_10m,pressure_msl,weathercode
&daily=sunrise,sunset,temperature_2m_max,temperature_2m_min
&timezone=auto`
).then(r=>r.json());

const aq=await fetch(
`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5&timezone=auto`
).then(r=>r.json());

localStorage.setItem("lastLocation",JSON.stringify({lat,lon,name}));

offlineCard.style.display="none";

$("location").textContent=name;
$("temp").textContent=Math.round(w.current_weather.temperature)+"Â°C";

const idx=w.hourly.time.indexOf(w.current_weather.time)>=0
  ? w.hourly.time.indexOf(w.current_weather.time)
  : 0;

/* Current conditions */
localTime.textContent=new Date(w.current_weather.time).toLocaleString();
feelsLike.textContent=w.hourly.apparent_temperature[idx]+"Â°C";
humidity.textContent=w.hourly.relativehumidity_2m[idx]+"%";
wind.textContent=w.hourly.windspeed_10m[idx];
pressure.textContent=w.hourly.pressure_msl[idx];
windCompass.style.transform=`rotate(${w.hourly.winddirection_10m[idx]}deg)`;

sunrise.textContent=new Date(w.daily.sunrise[0]).toLocaleTimeString([], {hour:"2-digit",minute:"2-digit"});
sunset.textContent=new Date(w.daily.sunset[0]).toLocaleTimeString([], {hour:"2-digit",minute:"2-digit"});

/* 24h */
const t24=w.hourly.temperature_2m.slice(idx,idx+24);
min24.textContent=Math.min(...t24)+"Â°C";
max24.textContent=Math.max(...t24)+"Â°C";

/* Hourly icons */
hourlyIcons.innerHTML="";
const icons={0:"â˜€ï¸",1:"ğŸŒ¤ï¸",2:"â›…",3:"â˜ï¸",45:"ğŸŒ«ï¸",61:"ğŸŒ§ï¸",71:"â„ï¸",80:"ğŸŒ§ï¸",95:"â›ˆï¸"};
for(let i=idx;i<idx+24;i++){
  hourlyIcons.innerHTML+=`
  <div class="hour">
    <div>${new Date(w.hourly.time[i]).getHours()}:00</div>
    <div>${icons[w.hourly.weathercode[i]]||"ğŸŒ¡ï¸"}</div>
    <div>${w.hourly.temperature_2m[i]}Â°</div>
  </div>`;
}

/* 7-day */
dailyForecast.innerHTML="";
w.daily.time.forEach((d,i)=>{
  dailyForecast.innerHTML+=`
  <div class="day-row">
    <span>${new Date(d).toLocaleDateString(undefined,{weekday:"short"})}</span>
    <span>ğŸŒ ${w.daily.temperature_2m_max[i]}Â°</span>
    <span>ğŸŒ™ ${w.daily.temperature_2m_min[i]}Â°</span>
  </div>`;
});

/* AQI */
const pm=aq.hourly.pm2_5[idx]??aq.hourly.pm2_5[0];
const pmPrev=aq.hourly.pm2_5[idx+1]??pm;
const aqi=pm25ToAQI(pm);
const [lab,cls,col,txt,mask]=aqiInfo(aqi);

aqiBadge.className="aqi "+cls;
aqiBadge.textContent=`AQI ${aqi} Â· ${lab}`;
aqiPM.textContent=`PM2.5: ${pm}`;
aqiText.textContent=txt;
maskTip.textContent=mask;
aqiTrend.textContent=aqi>pmPrev?"â†‘ Worsening":aqi<pmPrev?"â†“ Improving":"â†’ Stable";
aqiFill.style.width=Math.min(aqi/5,100)+"%";
aqiFill.style.background=col;

drawAQI(aq.hourly.pm2_5.slice(idx,idx+24).map(pm25ToAQI));

}catch{
const last=JSON.parse(localStorage.getItem("lastLocation")||"null");
if(last){
  offlineCard.style.display="block";
  loadWeather(last.lat,last.lon,last.name);
}
}
}

/* Controls */
searchBtn.onclick=async()=>{
  const q=cityInput.value.trim();
  if(!q)return;
  const r=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${q}&count=1`).then(r=>r.json());
  if(r.results)loadWeather(r.results[0].latitude,r.results[0].longitude,r.results[0].name);
};

locBtn.onclick=()=>{
  navigator.geolocation.getCurrentPosition(p=>{
    loadWeather(p.coords.latitude,p.coords.longitude,"Current Location");
    if(!watchId){
      watchId=navigator.geolocation.watchPosition(p2=>{
        loadWeather(p2.coords.latitude,p2.coords.longitude,"Current Location");
      });
    }
  });
};

loadWeather(28.61,77.23,"Delhi, India");
</script>
</body>
</html>
